
<!DOCTYPE html>
<html>
  <head>
    <title>Tokenized Card Payment</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          shortName:  "tokenized-card",
          specStatus: "unofficial",
          publishDate: "2016-09-15",
          editors: [
                {   name:       "Kevin Hurley",
                    company:    "Facebook" },
                {
                    name:      "Roy McElmurry",
                    company:   "Facebook"
                },
          ],
          license:      "w3c-software-doc",
          localBiblio:  {
              "BASICCARD": {
                  title: "Basic Card Payment"
              ,   href: "https://w3c.github.io/webpayments-methods-card"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ,   "Roy McElmurry"
                  ]
              ,   status: "ED"
              },
              "PAYMENTARCH": {
                  title:    "Payment Request Architecture"
              ,   href:     "https://w3c.github.io/browser-payment-api/specs/architecture.html"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ,   "Roy McElmurry"
                  ]
              ,   status:   "ED"
              },
              "PAYMENTREQUESTAPI": {
                  title:    "Payment Request API"
              ,   href:     "https://www.w3.org/TR/payment-request/"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ,   "Roy McElmurry"
                  ]
              ,   status:   "WD"
              },
              "METHODIDENTIFIERS": {
                  title:    "Payment Method Identifiers"
              ,   href:     "https://www.w3.org/TR/payment-method-id/"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ,   "Roy McElmurry"
                  ]
              ,   status:   "WD"
              },
          }
      };
    </script>
    <style>
    dt { margin-top: 0.75em; }
    table { margin-top: 0.75em; border-collapse:collapse; border-style:hidden hidden none hidden }
    table thead { border-bottom:solid }
    table tbody th:first-child { border-left:solid }
    table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
    li { margin-top: 0.5em; margin-bottom: 0.5em;}
    </style>
  </head>
  <body>
    <section id="abstract">
      <p>
        The Tokenized Card Payment specification describes the data formats used by the
        PaymentRequest API [[!PAYMENTREQUESTAPI]] to support payment by tokenized payment cards.
      </p>
    </section>
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        This specification is a <a href="#dfn-payment-transaction-message-specification">Payment Transaction Message Specification</a> used by the PaymentRequest API
        [[!PAYMENTREQUESTAPI]] to support payment by tokenized payment cards. Tokenization provides some advantages over traditional card payments - tokenized credentials are often narrowly scoped, for example single-use or merchant/amount/time scoped.  Tokenized credentials also help alleviate some concerns about merchant data breaches since the merchant does not have the raw PAN.  This provides some additional security for a consumer.
      </p>
      <p>
        This specification covers issuer and network tokens, but does not encompass all types of tokenization.  As an example, gateway tokens are not covered by this specification since they often require merchant onboarding with the token provider.  Network tokens are tokens (typically single-use) provided by card networks (i.e. Visa/MasterCard/American Express/Discover/etc.).  These tokens are a representation of the underlying PAN.  With issuer tokens, a provider serves as a card issuer by generating a new card number (not necessarily of the same type as the original PAN).  During charging of these tokens, the provider translates the generated card number back into the original PAN.
      </p>

      <p>The flow of issuer tokens is shown in the diagram below:</p>
      <img src="issuerTokens.png"/>

      <p>The flow of network tokens is shown in the diagram below:</p>
      <img src="networkTokens.png"/>
    </section>

    <section id="dependencies">
      <h2>Dependencies</h2>
      <p>
      This specification relies on several other underlying specifications.
      </p>
      <dl>
        <dt>Payment Request Architecture</dt>
        <dd>The terms <dfn data-lt="payment method|payment methods">Payment Method</dfn>,
        <dfn data-lt="payment app|payment apps">Payment App</dfn>, and <dfn>Payment Transaction
        Message Specification</dfn> are defined by the Payment Request Architecture document
        [[!PAYMENTARCH]].</dd>
        <dt>Basic Card Payment</dt>
        <dd>The term <dfn>BillingAddress</dfn> is defined by the Basic Card Payment specification [[!BASICCARD]].</dd>
        <dt>Payment Request API</dt>
        <dd>The term <dfn>PaymentRequest constructor</dfn> is defined by the PaymentRequest API
        specification [[!PAYMENTREQUESTAPI]].</dd>
        <dt>Payment Method Identifiers</dt>
        <dd>The term <dfn data-lt="payment method identifier|payment method identifiers">Payment
        Method Identifier</dfn> is defined by the Payment Method Identifiers specification
        [[!METHODIDENTIFIERS]].</dd>
        <dt>Web IDL</dt>
        <dd>The IDL in this specification is defined by Web IDL [[!WEBIDL]].</dd>
      </dl>
    </section>

    <section id="method-id">
      <h2>Payment Method Identifier</h2>
      <p>The <a>payment method identifier</a> string for the Tokenized Card Payment method is <dfn><code>card-token</code></dfn>.</p>
    </section>

    <section id="request">
      <h2>Payment Method Specific Data for the PaymentRequest constructor</h2>
      <p>This section describes payment method specific data that is supplied as part of the <code>data</code>
      argument to the <a>PaymentRequest constructor</a>.</p>

      <section>
      <h3>TokenCardRequest</h3>
      <pre class="idl">
        enum TokenCardType { "emv", "issuer" };

        dictionary TokenCardRequest {
          sequence&lt;DOMString&gt; supportedNetworks;
          sequence&lt;TokenCardType&gt; supportedTypes;
        };
      </pre>

      <p>
        The <code>TokenCardRequest</code> dictionary contains the following fields:
      </p>

      <dl>
        <dt><dfn><code>supportedNetworks</code></dfn></dt>
        <dd>The <code>supportedNetworks</code> field contains a sequence of identifiers for card networks
        that the merchant accepts.</dd>
        <dt><dfn><code>supportedTypes</code></dfn></dt>
        <dd>The <code>supportedTypes</code> field contains a sequence of token card types that the merchant
        accepts. Implementations will determine how to match the type values <code>emv</code>,
        and <code>issuer</code>.</dd>
      </dl>

      <p class="note">
        The <code>supportedNetworks</code> and <code>supportedTypes</code> fields are both optional.
        If neither is provided then any card may be returned. If only <code>supportedNetworks</code>
        is provided then any card type may be returned provided it matches one of the networks.
        If only <code>supportedTypes</code> is provided then a card may be returned from any network
        provided it matches one of the types.  It is expected that supportedTypes will be an evolving list.
      </p>

      </section>
    </section>

    <section id="response">
      <h2>Payment Method Response</h2>
      <p>
        The <dfn id="dom-tokenizedcardresponse"><code>TokenizedCardResponse</code></dfn> dictionary contains the response from the PaymentRequest API when a user accepts payment with a Tokenized Payment Card payment method.  The intention is for this to extend from the BasicCardResponse with some additional fields required for tokenization.  It should be noted that the "cardSecurityCode" from the BasicCardResponse will contain a card security code for issuer-based tokens, but will contain the cryptogram for network tokens.  The combination of cardNumber (the token number) + cardSecurityCode (either cryptogram or security code) establishes a one-time use credential.
      </p>

      <pre class="idl">
        dictionary TokenizedCardResponse: BasicCardResponse {
            required DOMString          cardLast4;
            DOMString          cardType;
            DOMString          tokenType;
            DOMString        tokenRequesterId;
        };
      </pre>

      <p>
        The <code>TokenizedCardResponse</code> dictionary contains the following fields:
      </p>

      <dl>
        <dt><dfn><code>cardLast4</code></dfn></dt>
        <dd>The <code>cardLast4</code> field contains the last 4 digits of the original (non-token) primary account number (PAN) for the payment card.  This may be used for display purposes during the purchase.</dd>
        <dt><dfn><code>cardType</code></dfn></dt>
        <dd>The <code>cardType</code> field contains the type (Visa, Mastercard, etc.) of the original (non-token) payment card.</dd>
        <dt><dfn><code>tokenType</code></dfn></dt>
        <dd>The <code>tokenType</code> field contains the type (Network, Issuer) of token.</dd>
        <dt><dfn><code>tokenRequesterId</code></dfn></dt>
        <dd>The <code>tokenRequesterId</code> field contains ID of the requester of the token (likely the creator of the payment app).  This field is only applicable to network tokenization.</dd>
      </dl>
    </section>
  </body>
</html>
